парсинг открытых и закрытых телеграмм каналов с помощью NITM на данном примере мы сейчас все посмотрим разберем здесь придется написать собственное API потому что для того чтобы парсить закрытый телеграмм каналы да есть какие то решения какие то платные какие то корявые но написать свою API вообще не составляет никакого труда мы это сделаем с помощью ChartGPT вернее я это уже сделал код есть я его просто дам и объясню как я его создавал он вообще простейший но работает на все 100 процентов есть различные сервисы как я уже сказал есть сервисы например для парсинга открытых каналов вот на подобии вот этого здесь можно просто с NIT, HTTP request запросом отправлять нужные ссылки, подставлять нужные каналы, лимиты, но все равно здесь не тот неполный функционал. Мы напишем такой, который закроет вообще все потребности. То есть мы сможем спарсить с любого канала, с закрытого, на который мы подписаны, естественно, с открытого, любую информацию за любой диапазон дат. У нас будет всего два workflow, вот основной и дополнительный. подробнее, вернее вот я опять его открыл дополнительный они отличаются только тем что основной к нему обращается к дополнительному и здесь он уже вытаскивает с помощью http request запроса но уже к нашему серверу к нашему API который мы сделаем вытаскивает необходимые данные по тому каналу по которому мы укажем собственно и естественно всю подробную внутрянку мы рассмотрим в мельчайших деталях также файлы проекта я скину скину в телеграм бот свой для этого нужно будет просто перейти в телеграм бот где кстати есть бесплатные уроки по NITM найти там вкладочку youtube видео и там будет внутри еще одна вкладочка где будут все сохранены материалы по этому уроку в том числе и проекты в том числе и код который мы будем загружать на свой сервер для создания своего API. Итак, поехали. Что нам потребуется? Нам потребуется установленный, настроенный NITN на своем сервере, либо на серверах самого NITN, вообще не имеет никакого значения. И если вы не знаете, как это сделать, то это опять же есть в боте, в бесплатных уроках. Затем нам потребуется ваш Telegram аккаунт, который подписан на какие-то закрытые, открытые каналы. И когда мы перейдем на наш API, который создадим, то получим вот такую вот картину. То есть вот это... API отдает мне каналы в Telegram, на которые я подписан. То есть их ID-шники. Их очень много. Тут и закрытые, и открытые присутствуют. Вот видите, я обратился по определенному GET-запросу к своему API. И он мне выдал эту информацию. Предварительно я авторизировался. Все этапы мы все это сейчас пройдем. и нам понадобится сервер для того чтобы на нем поднять API ну и инструменты telegram разработчика где мы создадим ID нашего приложения который потребуется для решения этой задачи в качестве сервера я буду использовать bget создам сервер с нуля у меня уже есть созданные которые работают но для того чтобы все пройти по шагам чтобы было все понятно создам с нуля вообще ничего сложного все довольно просто где создавать сервер вообще не имеет значения вы можете это сделать с любым дистрибутивом, Debian, неважно главное установить на него Node.js и менеджер пакетов Node.js NPM либо как на Biget можно создать сразу же готовую настроенную среду Node.js Но прежде чем ко всему к этому приступим давайте посмотрим как работает собственно в данном случае наш агент то есть у него есть ID канала который мы взяли который нам нужен для парсинга может быть несколько ID добавлено, ну для примера добавлен там сейчас один и мы можем спросить его какую то информацию по этому каналу либо это можно делать все на автомате когда нужен автоматический парсинг соответственно здесь вместо чата вставляем парсинг по какому то времени там каждые пять минут каждые полчаса каждый день и он может быть на помощь например брать кита крипто сигнала с каналов закрытых на которой вы подписаны и отправлять их куда следует для дальнейшей обработки либо может делать краткую выжимку саммари сразу с нескольких каналов и отправлять например в ваш телеграмм канал то есть как дальше будут развиваться события это уже на вашу фантазию на ваше усмотрение самое сложное мы естественно сейчас рассмотрим как реализовать именно доступ и парсинг а уже что делать с данными вы там уже сами придумаете мы можем например спросить о чем Так как никаких дополнительных промптов нету, то здесь просто прямая передача. Я ему прямо и спрашиваю, о чем последние три поста в Телеграм-канале, скажи кратко. Тут можно, например, спросить за конкретную дату, за выборку с какой-то даты по какую. Ну, в общем, собственно, вот он мне выдал последние три поста. Тут про иконки, про шрифты. Но немного напутал с датами, потому что нужно не так формулировать запрос. Не за последнюю дату, а нужно за конкретную. Ну в этом случае, потому что внутри промптов нет. И здесь он, собственно, обратился к другому workflow, который отвечает за парсинг. Вот к этому. И мы можем посмотреть, что оно отработало. Агент отправил соответствующий HTTP request запрос и получил информацию. ну а теперь когда мы знаем как это выглядит вкратце как это работает давайте перейдем к реализации в самом начале создадим сервер я буду использовать biget создам уже сразу с настроенной средой Node.js расположение не имеет значения в данном случае выберу здесь Node.js платформу вот он встанет на Ubuntu и установится необходимый нам инструмент PM2 с помощью него мы будем запускать наш скрипт и в случае если там какого-то перебоя он упадет, то он заново перезапустится все, нажимаем выбрать оставляем все по умолчанию здесь в качестве домена мы можем выбрать бесплатный технический домен но в принципе мы им не будем пользоваться потому что в данном случае Node.js будет отдавать HTML по этому домену а мы создадим отдельно свой сервер и будем к нему обращаться из NIT просто по адресу сервера поэтому домен не имеет значения здесь из важного лучше задать тот пароль для сервера который вы сможете напечатать потому что у новичков это частая проблема с копированием и вставлением пароля в командную строку потому что он там не отображается непонятно ввел ты его или не ввел давайте придумаем пароль должны присутствовать буквы спецсимволы и символы даже тут я когда-то выводил видимо для урока Node.js может быть без lessons покороче 1 2 3 восклицательный знак так все остальное по умолчанию создать сервер все запущено создание сервера когда он создастся также было бы неплохо кстати его назвать как то говорящим именем чтобы понимать какой потом в случае чего удалять итак сервер у меня установился надо его запомнить TESSA и теперь мы будем работать сразу в двух средах для того чтобы было попроще и в визуальном редакторе и через командную строку по сути можно все делать через командную строку но опять же для более понятного объяснения буду использовать в том числе и визуальный редактор тот же файловый менеджер можем в него сейчас перейти на этот сервер который создали здесь внимательно следите переходим папочку var далее папочка 3w и здесь рядом с папкой html создаем новую папку которую называем сервер ну просто чтобы было нам понятно теперь мы зайдем на сервер в командную строку зайдем в эту папочку и инициализируем там Node.js проект для этого просто переходим в командную строку так у меня здесь какой-то другой открыт я перезайду для того чтобы войти на серию возвращаемся на бигет смотрим доступ по SSH то есть копируем вот это подключение здесь пишем SSH неважно где вы работаете на макбуке на windows в принципе везде один и тот же и копируем можно правой кнопкой мыши вставить кликом то что мы скопировали затем соглашаемся здесь пишем ES и вводим пароль который не отображается так у меня заглавная была Node.js 123, восклицательный знак. Да, я не забыл пароль. Если вы забыли пароль, то можно сбросить, но имейте в виду, в этом случае нужно будет перезагрузить сервер, чтобы ваш сброс пароля заработал. Все, я сейчас нахожусь на сервере, я могу выйти на один уровень выше, посмотреть, что у меня здесь находится, команда ls, вот все наши папочки, собственно, как в файловом менеджере. и заходим по пути var3w то есть идем сидим пишем var3w какие здесь папочки html и server и заходим в нашу папочку server то есть сиди теперь можем здесь инициализировать Node.js проект кстати предварительно можно проверить вообще у нас установлен Node.js командой nodev и мы смотрим версию То есть у нас версия 22.18.0. То же самое касается и пакетного менеджера. То есть npm, defis.w, все установлено. Итак, мы находимся в этой папочке, и теперь командой npm init, инициализируем Node.js проект. Здесь можно какие-то свои кастомные имена добавлять в версии, мы все пролистываем, ничего не добавляя. теперь если мы посмотрим до этого пустую папку сервер то увидим что здесь создался файл package.json который мы будем редактировать а собственно мы возьмем уже готовые настройки скопируем и вставим в него для этого перейдем в файловый менеджер нужно будет перезайти потому что у нас обновилось перейдем по тому же пути вот наш package.json откроем и вставим данные с необходимыми зависимости тут по сути мы устанавливаем различные библиотеки для правильной работы нашего API и указываем что при старте наш стартовый файл это index.js хотя по сути мы запустим его один раз все сохраняем и теперь когда мы перейдем в командную строку мы можем установить все эти зависимости командой npm install либо просто npm i сейчас все необходимые библиотеки установятся за несколько секунд и как мы видим все успешно установилось теперь давайте снова выйдем из файлового менеджера и заново в него войдем для того чтобы создать файлы это можно делать в командной строке как я уже говорил но я предполагаю что основная аудитория у меня это не программисты поэтому мы по простому так и перейдем в сервер и создадим здесь два файла один назовем вернее три даже один назовем index.js второй назовем server.js и третий назовем .env здесь будут храниться глобальные переменные, которые мы получим от приложения Telegram. Давайте по порядку начнем заполнять эти файлы. Особо я не буду останавливаться, если вы захотите, вы сможете зайти, взять этот код, подробно его изучить, скинуть чат в GPT, спросить, а что делается здесь, а что делается там. Там все очень просто, даже без каких-то навыков программирования, думаю, все можно будет понять. итак, env мы закидываем сейчас я возьму подготовленную конструкцию давайте его создадим наверное заново с маленькой буквы и закидываем в него глобальные переменные которые нужно заполнить нам нужно id приложения, hash и session для того чтобы взять id и hash переходим по этому адресу про который я вам уже говорил и api development tools у меня уже там все создано сейчас будет там замыто вам нужно будет просто создать приложение и когда вы создадите новое приложение у вас появится ID и hash, собственно эти два значения AppTitle вы можете заполнить как хотите, короткое имя тоже эти все остальные данные нам в этом случае не потребуется вы копируете ID, копируете hash возвращаетесь пишите здесь ID я напишу что попало, hash что попало вы естественно вставляете свои дальше session, для того чтобы получить session нам нужно так сохраним авторизироваться в Telegram под вашим аккаунтом с вашего устройства для этого давайте заполним файл индекс который тоже можно будет скопировать у меня в боте то есть вставляем и заполняем сюда вставляем ID вставляем хэш ну здесь естественно фейковые данные сохраняем ну и давайте сразу заполним файл сервер напоминаю есть вот этот код который мы вставляем я получил от чата GPT просто задав ему такую задачу объяснив что нужно мне с телеграмма парсить закрытых каналов что хочу делать это через API и создай мне для этого все необходимые файлы и он сделал мне эти файлы они сразу не заработали в процессе мы там допилили чтобы он возвращал именно по дате там были у нас проблемы с форматом то есть были какие то ошибки но это все опять же очень просто решалось путем ему дописывания это еще на старой версии GPT а сейчас я думаю с выходом новой GPT-5 это еще легче все делается в общем здесь я ни строчки кода сам не написал то есть все сделал GPT и так же сохраняем и теперь нам остается получить session_id для того чтобы вставить его в глобальные переменные вот сюда для этого на нашем сервере нужно запустить файл index который мы заполнили с помощью команды ноды index но так как у меня там вбиты фейковые данные то это не сработает сейчас я перезайду на другой свой сервер который с нормальными данными но он полностью такой же там то есть полностью все те же файлы только другие данные все я перешел на другой свой сервер где уже свои реальные данные у меня вставлены также перейду сначала в основной каталог потом перейду в нашу папку которая располагается по пути var3w-server здесь находится наш индекс папка nodemodules package и server.js и запущу файл index.js чтобы получить session как я и говорил пишу ноды index сейчас он спросит мой номер телефона я его пишу замылю на этот номер телефона сейчас придет код в telegram я его ввожу потом попросит ввести пароль от telegram я его тоже ввожу и вот он вот этот session string я его копирую полностью дальше могу к trlc выйти копирую и вставляю вот сюда то есть длинное длинное значение оно сюда вставится закрываю сохраняю ну а для того чтобы все заработало нам нужно запустить скрипт который сервер JS, который отвечает за отдачу данных телеграм-каналов, которые мы запросим. То есть мы запускаем для этого... Сейчас опять же я перейду в корневой каталог, потом с него перейду в каталог, где расположены все скрипты. И запущу файл сервер JS командой pm2. сервер JS мы так запускаем для того чтобы в случае какого-то сбоя произошла автоматическая перезагрузка и скрипт заново перезапустился чтобы наша API бесперебойно работала но это тоже не спасает вас в некоторых случаях от того что сервер у вас упадет полностью когда какие то большие запросы когда не хватает ему памяти процессорной мощности для обработки то есть за этим тоже нужно следить и если такое случается то перезагружать сам сервер непосредственно у хостера запускаем команду но я ее неправильно написал потому что нужно написать pm2 start server.js но она у меня не запустилась потому что она у меня уже запущена это можно проверить и посмотреть что у меня сервер уже запущен онлайн и работает и теперь мы можем уже по API к нему обращаться и он будет отдавать содержимое указанных каналов и сразу же мы можем проверить насколько удачно у вас все получилось сделать для этого переходим по адресу http:// адрес вашего сервера который можно взять посмотреть вот здесь но у меня сейчас другой потому что я на другом сервере запустил а здесь у меня как бы с учебными данными то есть вот этот адрес это адрес вашего сервера и порт порт мы прописали в скрипте поэтому оставляем его как у меня двоеточие 3005 и пишем get channels после чего мы должны получить список всех ваших каналов и закрытых и открытых ну в таком вот виде можно в браузере поставить галочку форматировать мы видим название канала видим его айди название айди название айди но вот топор плюс по моему закрытый канал давайте я скопирую этот айди потом перехожу в проекты на iten и сейчас мы уже добрались до того момента когда мы начнем подробно рассматривать устройство workflow в наитен тут оно сильно долго времени не займет потому что довольно простое и поставлю вместо того по шрифтам который был до этого установлен в одном месте только оставлю здесь можно естественно несколько сейчас просто проверим работоспособность а потом перейдем и пробежимся по всем промптам и по тому как там внутри все устроено о чем пост за 15 марта 2025 все мозги промылись видим что сейчас уже информация не по шрифтам не по дизайну а именно по топору 18 и за ту дату за которую необходимо В общем все работает. Теперь давайте быстренько пробежимся, уже финальная стадия у нас, пробежимся по тому, как внутри все устроено. Здесь простейший агент. Промп на русском языке, естественно на русском языке в продакшене не нужно оставлять. Обязательно переводим на английский, это и токены сэкономит почти в два раза используемые. И мало того, это самое главное, модель будет лучше понимать, потому что все равно он переводит в английский потом. но для разработки я все время на русском, потом перевожу. Ты умный агент, сегодня вот такая дата, используем выражение, чтобы показать ему текущую дату. У тебя основной инструмент для формирования ответов такой-то, который мы подключаем, всегда отвечает только на основании этого инструмента. Всегда после вопроса пользователя отправляй сообщение с помощью инструмента Telegram Tool, о том, что ты начал процесс и будет ответ. У нас такого инструмента даже нет, видимо тут на тестировании он был. то есть это можно даже удалить либо добавить этот инструмент бывает полезно если ответ долго подготавливается он может пока парсить с сайта он может отправить сообщение ну если к телеграмму конечно это подключено потому что у меня это взято с телеграм проекта где в телеграм боте задавались собственные вопросы инструмент open clause использую для того чтобы спарсить данные за любую дату из указанного канала и id канала для парсинга обязательно отправляй в этот инструмент id канала и формируй пром который может решить запрос пользователя тоже отправь вместе с 1 канала дальше но тут обычная память обычная лопнула и джеки 4 оао и собственно вот мы обращаемся к этому инструменту которого которые выбрали я вот здесь здесь мы задаем имя по которому там обращаемся в агенте ты должен пойти дискрипшене в этом струнете с нужной данной стрелам канала открытых или закрытых и собственно этот инструмент выглядит таким образом тоже он подключен к openai тоже у него память какая то оконная обычная здесь в агенте системное сообщение ты умный ассистент единственная задача которого правильно сформировать ссылку в зависимости от запроса пользователя отправляю ее в инструмент request который вот у нас request и дальше мы описываем получается этого инструмента постов и отправлять дальше в виде краткой выжимки это опять же у меня осталось от старого проекта потому что там требовалась выжимка то есть можно здесь это вообще удалить для формирования ссылки использую следующее данное и мы ему отправляем ссылку в таком формате где у нас адрес сервера нашего дальше команда которая парсит с выбранного канала сюда подставляется ID канала сюда подставляется лимит постов который вытаскивается и сюда подставляется дата от которой они вытаскиваются и собственно дальше вот это все расшифровывается ну и мы здесь по простому описываем что нам передает пользователь и он сам например лимит подставляет в зависимости от запроса пользователя дату тоже подставляет в зависимости от запроса пользователя ну а канал ему там жестко передается также описан формат получения постов не помню для чего возможно это связано с прошлым проектом И по поводу даты здесь дополнительная расшифровка, потому что он путался с датами изначально. Ну и потом еще под конец мы показываем сформированную ссылку, как она выглядит. То есть его задача просто вот этого агента сформировать вот такую ссылку, которую отправить в реквест. Все, он больше ничем не должен заниматься. Все остальное в предыдущем агенте делается. И как мы видим здесь вот адрес поста, дальше ID канала в качестве примера, количество постов вытаскиваемых и дата тоже в качестве примера. и собственно сам инструмент http request у него есть описание тоже вот такое простое твоя задача подставить в ссылку необходимые данные и описываем какие данные подставить а в ссылку уже которую передаем у нас ставятся именно вот эти типы переменные куда подставляются данные то есть все достаточно просто вообще эту схему можно реализовать и без второго агента то есть просто здесь по цепочке запускать http request и туда подставить все необходимые данные которые изначально получить и передать с прошлого агента просто вот в данном случае он вырван из контекста из одного из моих проектов и поэтому он так выглядит и что самое ценное во всем этом что хотел я донести до вас вы только посмотрите с какой легкостью можно создавать свои опишки поднимать любому человеку без какого то программистского бэкграунда и решать вообще наисложнейшие задачи вообще любые задачи киевом только в голову взбредут и данная демонстрация это не только демонстрация того как можно вытаскивать по опи с закрытых каналов какие то данные Это демонстрация того, как можно легко создавать свои API-сервисы для своих разных задач. Ну а если было полезно, лайк, подписка, коммент в поддержку этого видео.